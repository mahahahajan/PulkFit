name: Daily Workout Automation

on:
  workflow_dispatch:       # allows manual triggering for testing
  schedule:
    # Runs daily at 8:00 AM ET (adjust UTC offset depending on daylight savings)
    - cron: "* 12 * * *" # 8 AM ET is 12:00 UTC (standard time)


jobs:
  run_workout_scripts:
    runs-on: ubuntu-latest

    env:
      GMAIL_CREDENTIALS: ${{ secrets.GMAIL_CREDENTIALS }}
      GMAIL_TOKEN: ${{ secrets.GMAIL_TOKEN }}
      NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
      HEVY_EMAIL: ${{ secrets.HEVY_EMAIL }}
      HEVY_PASSWORD: ${{ secrets.HEVY_PASSWORD }}
      GEMINI_AI_KEY: ${{ secrets.GEMINI_AI_KEY }}
      FITBIT_USER_DETAILS: ${{ secrets.FITBIT_USER_DETAILS }}
      FITBIT_CLIENT_DETAILS: ${{ secrets.FITBIT_CLIENT_DETAILS }}

    steps:
      # 1. Checkout the repo
      - name: Checkout Repo
        uses: actions/checkout@v3

      # 2. Setup Python
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      # 3. Install dependencies
      - name: Install Dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      
      - name: Ensure temp_downloads exists
        run: mkdir -p temp_downloads

      - name: Save initial Fitbit user details
        run: |
          if [ ! -f temp_downloads/user_details.json ]; then
            echo "${FITBIT_USER_DETAILS}" > temp_downloads/user_details.json
            echo "Saved initial Fitbit user details"
          else
            echo "User details already exist, skipping initial save"
          fi

      # 4. Run script
      - name: Run Daily Script
        run: |
          python run_daily.py
